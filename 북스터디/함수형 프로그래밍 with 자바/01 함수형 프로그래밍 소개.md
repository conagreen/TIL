# 01. 함수형 기초

이 책의 주된 목적은 함수형의 개념과 관용구를 소개하고, 이러한 개념들을 자바 코드에 효과적으로 결합하는 방법을 안내하는 것이다.

아래는 이 책을 통해서 학습할 수 있는 개념들이다.

- **합성**: 모듈식으로 쉽게 합성할 수 있는 블록을 구축한다.
- **표현식**: 의도를 명확하게 표현하는 간결한 코드를 작성한다.
- **코드 안정성**: 오류를 발생시키지 않고 경합 조건이나 락을 처리할 필요가 없는 더 안전한 자료 구조를 만든다.
- **모듈성**: 큰 프로젝트를 더 쉽게 관리할 수 있는 모듈로 분할한다.
- **유지 보수성**: 연관성이 적은 함수형 블록들을 사용하여 코드의 다른 부분을 손상시키지 않으면서 코드 변경이나 리팩터링을 더 안전하게 수행할 수 있다.
- **데이터 조작**: 더 적은 복잡성으로 효율적인 데이터 조작 파이프라인을 구축한다.
- **성능**: 불변성과 예측 가능성을 통해 큰 고민 없이 병렬로 수평 확장이 가능하다.

## 함수형 프로그래밍 소개

### 어떤 것이 언어를 '함수형'으로 만드는가?
프로그래밍 언어가 추상 함수를 생성하고 조립함으로써 논리 연산을 표현할 수 있을 때 함수형 언어로 간주된다. 이 개념은 '**람다 대수**' 라는 수학적 원리를 기반으로 한다.
람다 대수는 추상 함수를 이용하여 수학 연산을 표현하고, 이를 변수에 바인딩하는 방법을 의미한다.

**[ 람다 대수 ]**
- **추상화**: 단일 입력을 받는 익명 함수, 즉 람다를 의미한다.
- **응용**: 값에 추상화가 적용되어 결과를 생성한다. 개발자의 관점에서는 함수나 메서드 호출을 의미한다.
- **베타 축약**: 추상화된 변수를 적용된 인수로 대체하는 과정을 말한다.

함수형 프로그래밍 언어가 되기 위해서는 연산의 논리를 선언적 문장으로 표현할 수 있어야 한다. 
이러한 선언적 프로그래밍 스타일에서는 문장이 아닌 표현식을 사용하여 결과와 프로그램이 작동하는 방식을 설명한다.
즉, 무엇을 해야 하는지가 아닌 **무엇을 원하는지를 표현한다**.

### 함수형 프로그래밍의 개념

**1. 순수 함수와 참조 투명성**

함수형 프로그래밍에서는 함수를 **순수 함수**와 **불순 함수**로 분류한다. 

순수 함수는 다음 두 가지 조건을 만족해야 한다.

- **동일한 입력에 대해 항상 동일한 출력을 반환** -> 순수 함수의 리턴 값은 함수 호출 시 입력되는 인수에 의존한다. 
- **어떠한 사이드 이펙트 없이 자기 충족적 성질을 가짐** -> 코드는 인수 박을 변경하거나, I/O 를 사용하는 등 글로벌 상태에 영향을 미치지 않는다.

이 두 가지 조건 중 하나라도 위반하면 불순 함수로 간주된다.

> **[주의]** 순수 함수와 불순 함수라는 용어에 오해의 소지가 있을 수 있다.
> 
> 이 두 용어는 단지 코딩 스타일과 패러다임에 따른 차이일 뿐, 순수 함수가 불순 함수보다 기능적으로 더 우수하다는 의미는 아니다.


[ 순수 함수 예시 ]
```java
public int add(int a, int b) {
    return a + b;
}
```

[ 불순 함수 예시 ]
```java
public int calculateAndModifyGlobal(int a, int b) {
    LocalTime now = LocalTime.now();
    int result = 0;

    // 동일한 입력에 대해 항상 동일한 출력을 반환하지 않음
    if (now.isAfter(LocalTime.of(9, 0))) {
        result = a - b;
    } else {
        result = a + b;
    }

    // 전역 변수를 수정하는 사이드 이펙트가 발생
    global = result;
    return result;
}

// 전역 변수
public static int global = 0;
```


**2. 불변성**
- 함수형 프로그래밍에서는 데이터의 불변성을 중시한다. 데이터가 변경되지 않으므로, 사이드 이펙트가 발생하지 않고 코드의 안정성을 높일 수 있다.
- 자료 구조를 직접 변경하는 대신에 변경된 상태를 포함하는 업데이트된 새로운 버전을 생성해야 한다.
- 데이터가 변경될 때마다 매번 복사해야 해서 비효율적일 수 있지만 **구조 공유**를 사용하여 효율적인 복사 메커니즘을 제공한다. 

**3. 재귀**
- 재귀는 자기 자신을 호출하는 반복 작업을 통해 최종적으로 원래의 문제를 해결하는 문제 기법이다.
- 순수 함수형 프로그래밍은 종종 반복문이나 반복자 대신에 재귀를 선호하는 경향이 있다. 
- 재귀 함수는 스택 오버플로의 위험성이 있다. 이러한 이유로 많은 함수형 언어는 스택 프레임을 줄이기 위해 **꼬리 물기 최적화** 또는 **루프 언롤링**과 같은 최적화 기법을 활용한다.

**4. 일급 함수와 고차 함수**

- 함수는 일급 객체(first-class citizen)로 취급되며, 변수에 할당하거나 다른 함수의 인수로 전달할 수 있다. 
- 고차 함수는 함수를 인수로 받거나 함수를 반환하는 함수이다.

**5. 함수 합성**

- 순수 함수들을 결합하여 새로운 함수를 생성한다. 이는 코드의 재사용성을 높이고, 복잡한 로직을 간결하게 표현할 수 있게 한다.

**6. 커링**

- 여러 개의 인수를 받는 함수를 단일 인수 함수들의 체인으로 변환한다. 이를 통해 부분 적용 함수 애플리케이션을 쉽게 만들 수 있다.

**7. 부분 적용 함수 애플리케이션**

- 부분 적용 함수 애플리케이션은 기존 함수의 일수 중 일부만 제공하여 새로운 함수를 생성하는 과정을 말한다. 
- 이를 통해 현재 문맥과 요구 사항에 맞게 새롭고 간결한 함수를 즉석에서 생성하거나 더 일반적인 함수 집합에서 특수화된 함수를 생성할 수 있다.

**8. 느긋한 계산법**

- 필요한 시점까지 계산을 미루는 전략이다. 이를 통해 성능을 최적화하고 불필요한 계산을 방지할 수 있다.
- 비함수형 언어도 if-else 문이나 반복문과 같은 몇 가지 느긋한(lazy) 구조를 갖고 있다.

### 함수형 프로그래밍의 장점

- **간결성**: 가변 상태에서 사이드 이펙트가 없는 경우 함수는 보통 더 작아지며 해야할 일만 수행한다.
- **일관성**: 불변 자료 구조는 신뢰성과 일관성이 있다. 예상치 못하거나 의도하지 않은 프로그래밍 상태에 대해 걱정할 필요가 없다.
- **(수학적) 정확성**: 코드가 '순수'할수록 논리적 추론이 더 쉬워지므로 디버딩과 테스팅이 간단해진다.
- **안전한 동시성**: 함수형 개념을 활용함으로써 다양한 문제를 해결하고, (거의) 비용 없이 안전한 병렬 처리의 이점을 누릴 수 있다.
- **모듈성**: 함수형 합성과 부분 적용이 결합되어 이러한 작은 부분을 쉽게 통합하여 더 복잡한 작업을 할 수 있게 한다.
- **테스트 용이성**: 순수 함수, 참조 투명성, 불변성, 역할 분리와 같은 함수형 개념들은 테스트와 검증을 더 쉽게 만든다.


### 함수형 프로그래밍의 단점
- **학습 곡선**: 함수형 프로그래밍은 고급 수학 용어와 개념을 기반으로 하기 때문에 다소 어렵게 느껴질 수 있다.
- **고수준 추상화**: 객체 지향 프로그래밍이 객체를 사용하여 추상화를 모델링하는 반면, 함수형 프로그래밍은 더 높은 추상화 수준을 사용하여 이해하기 어려울 수 있다.
- **상태 처리**: 상태 변경이 필요한 경우 구현이 복잡할 수 있다.
- **성능 영향도**: 불변성이나 재귀와 같은 많은 함수형 기술은 오버헤드로 인해 성능이 저하될 수 있다.
- **최적의 문제 상황**: 모든 문제에 함수형 프로그래밍이 적합하지 않을 수 있다.  


## 회고
객체 지향 언어인 자바를 기반으로 개발하다 보니, 함수형 언어는 다소 낯설고 이해하기 어려운 부분들이 있다. 처음 프로그래밍을 접했을 때의 이유와 동일하다. 객체지향 언어는 마치 문과라면, 함수형 언어는 이과 같은 존재다..(수포자의 한탄) 

챕터 1에서는 가볍게 함수형 프로그래밍에 대한 내용과 이를 만족시킬 수 있는 요소들에 대해 공부해 봤다. 다음 챕터에서는 좀 더 깊은 내용과 더불어 자바에서 실제 사용하는 문법을 배우게 될 텐데, 아직까지는 커링과 부분 적용 함수 애플리케이션에 대한 내용이 완전히 이해가 가지 않는다. 

커링은 여러 개의 인수를 받는 함수를 단일 인수 함수들의 체인으로 변환하는 개념이고, 부분 적용 함수 애플리케이션은 함수의 일부 인수를 미리 채운 새로운 함수를 생성하는 방법이라는데.. 이러한 개념들이 아직까지는 낯설고 어렵게 느껴진다.

함수형 프로그래밍의 다양한 개념을 익히면서, 객체 지향 프로그래밍과의 차이점을 명확히 이해하게 되는 것이 중요할 것 같다. 이를 통해 더 나은 코드 작성과 유지 보수가 가능한 프로그래밍 패러다임을 습득할 수 있길 바라며 마무리하겠다.
